loudfunctions/sendReminder/config.json# å¾®ä¿¡å°ç¨‹åºè®¢é˜…æ¶ˆæ¯æµ‹è¯•æŒ‡å—

## âš ï¸ é‡è¦æç¤º

**è®¢é˜…æ¶ˆæ¯åªèƒ½åœ¨çœŸæœºä¸Šæµ‹è¯•ï¼Œå¼€å‘è€…å·¥å…·æ— æ³•æµ‹è¯•ï¼**

## ğŸ“‹ æµ‹è¯•å‰æ£€æŸ¥æ¸…å•

### 1. è®¢é˜…æ¶ˆæ¯æ¨¡æ¿é…ç½®

1. ç™»å½•[å¾®ä¿¡å…¬ä¼—å¹³å°](https://mp.weixin.qq.com/)
2. è¿›å…¥å°ç¨‹åºåå° â†’ **åŠŸèƒ½** â†’ **è®¢é˜…æ¶ˆæ¯**
3. ç¡®è®¤å·²ç”³è¯·è®¢é˜…æ¶ˆæ¯æ¨¡æ¿
4. æ£€æŸ¥æ¨¡æ¿IDæ˜¯å¦æ­£ç¡®ï¼š
   - `cloudfunctions/sendReminder/index.js` ç¬¬69è¡Œ
   - `miniprogram/pages/home/index.js` ç¬¬425è¡Œï¼ˆsubscribeMessageå‡½æ•°ä¸­ï¼‰

### 2. äº‘å‡½æ•°éƒ¨ç½²æ£€æŸ¥

1. ç¡®è®¤ `sendReminder` äº‘å‡½æ•°å·²éƒ¨ç½²
2. æ£€æŸ¥äº‘å‡½æ•°æƒé™ï¼š
   - åœ¨äº‘å¼€å‘æ§åˆ¶å° â†’ äº‘å‡½æ•° â†’ `sendReminder` â†’ æƒé™è®¾ç½®
   - ç¡®ä¿æœ‰ `openapi.subscribeMessage.send` æƒé™

### 3. æ•°æ®åº“æ£€æŸ¥

1. ç¡®è®¤ `subscribe_settings` é›†åˆå·²åˆ›å»º
2. æ£€æŸ¥é›†åˆæƒé™ï¼š**ä»…åˆ›å»ºè€…å¯è¯»å†™**
3. æŸ¥çœ‹æ•°æ®åº“ä¸­æ˜¯å¦æœ‰ä½ çš„è®¢é˜…è®°å½•ï¼š
   ```javascript
   // åœ¨äº‘å¼€å‘æ§åˆ¶å° â†’ æ•°æ®åº“ â†’ subscribe_settings
   // æŸ¥çœ‹æ˜¯å¦æœ‰ä½ çš„ openid å¯¹åº”çš„è®°å½•
   ```

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### æ–¹æ³•ä¸€ï¼šçœŸæœºæµ‹è¯•ï¼ˆæ¨èï¼‰

1. **åœ¨çœŸæœºä¸Šæ‰“å¼€å°ç¨‹åº**
   - ä½¿ç”¨å¾®ä¿¡æ‰«ç æˆ–åˆ†äº«åˆ°æ‰‹æœº
   - **æ³¨æ„**ï¼šå¿…é¡»ä½¿ç”¨çœŸæœºï¼Œå¼€å‘è€…å·¥å…·æ— æ³•æµ‹è¯•è®¢é˜…æ¶ˆæ¯

2. **è®¢é˜…æ¶ˆæ¯**
   - ç‚¹å‡»é¦–é¡µçš„é“ƒé“›å›¾æ ‡
   - é€‰æ‹©"æ·±åº¦å†¥æƒ³"è®¡åˆ’ï¼ˆæ¯å¤©3æ¬¡ï¼‰
   - å¼€å¯æé†’å¼€å…³
   - ç‚¹å‡»"å¼€å¯æé†’è®¡åˆ’"
   - **æˆæƒè®¢é˜…æ¶ˆæ¯**ï¼ˆä¼šå¼¹å‡ºæˆæƒå¼¹çª—ï¼‰

3. **æ£€æŸ¥è®¢é˜…ç»“æœ**
   - åœ¨äº‘å¼€å‘æ§åˆ¶å° â†’ æ•°æ®åº“ â†’ `subscribe_settings`
   - æŸ¥çœ‹ä½ çš„è®°å½•ï¼Œç¡®è®¤ï¼š
     - `enabled: true`
     - `type: "daily"`
     - `times: 3`
     - `subscribeResult` ä¸­æœ‰æ¨¡æ¿IDå’ŒæˆæƒçŠ¶æ€

4. **ç­‰å¾…å®šæ—¶è§¦å‘**
   - å®šæ—¶è§¦å‘å™¨ä¼šåœ¨ 10:00ã€14:00ã€20:00 æ‰§è¡Œ
   - å¦‚æœå½“å‰æ—¶é—´ä¸åœ¨è¿™äº›æ—¶é—´ç‚¹ï¼Œéœ€è¦ç­‰å¾…

### æ–¹æ³•äºŒï¼šæ‰‹åŠ¨è§¦å‘äº‘å‡½æ•°æµ‹è¯•

å¦‚æœä¸æƒ³ç­‰å¾…å®šæ—¶è§¦å‘ï¼Œå¯ä»¥æ‰‹åŠ¨è§¦å‘äº‘å‡½æ•°ï¼š

1. **ä¿®æ”¹äº‘å‡½æ•°ä»£ç ï¼ˆä¸´æ—¶æµ‹è¯•ï¼‰**
   
   åœ¨ `cloudfunctions/sendReminder/index.js` ä¸­ï¼Œä¸´æ—¶æ³¨é‡Šæ‰æ—¶é—´æ£€æŸ¥ï¼š
   
   ```javascript
   // ä¸´æ—¶æµ‹è¯•ï¼šæ³¨é‡Šæ‰æ—¶é—´æ£€æŸ¥
   // const matchedTime = REMINDER_TIMES.find(time => {
   //   return Math.abs(currentHour - time.hour) <= 0 && Math.abs(currentMinute - time.minute) <= 5
   // })
   
   // if (!matchedTime) {
   //   return {
   //     success: false,
   //     message: 'å½“å‰æ—¶é—´ä¸åœ¨æé†’æ—¶é—´ç‚¹'
   //   }
   // }
   
   // ä¸´æ—¶ä½¿ç”¨ç¬¬ä¸€ä¸ªæ—¶é—´ç‚¹
   const matchedTime = REMINDER_TIMES[0]
   ```

2. **é‡æ–°éƒ¨ç½²äº‘å‡½æ•°**
   - åœ¨äº‘å¼€å‘æ§åˆ¶å° â†’ äº‘å‡½æ•° â†’ `sendReminder`
   - ç‚¹å‡»"ä¸Šä¼ å¹¶éƒ¨ç½²"

3. **æ‰‹åŠ¨è§¦å‘**
   - åœ¨äº‘å¼€å‘æ§åˆ¶å° â†’ äº‘å‡½æ•° â†’ `sendReminder`
   - ç‚¹å‡»"æµ‹è¯•"æŒ‰é’®
   - è¾“å…¥æµ‹è¯•å‚æ•°ï¼š`{}`
   - ç‚¹å‡»"è¿è¡Œæµ‹è¯•"

4. **æŸ¥çœ‹ç»“æœ**
   - æŸ¥çœ‹äº‘å‡½æ•°æ—¥å¿—ï¼Œç¡®è®¤æ˜¯å¦å‘é€æˆåŠŸ
   - æ£€æŸ¥æ‰‹æœºæ˜¯å¦æ”¶åˆ°è®¢é˜…æ¶ˆæ¯

5. **æµ‹è¯•å®Œæˆåæ¢å¤ä»£ç **
   - æ¢å¤æ—¶é—´æ£€æŸ¥é€»è¾‘
   - é‡æ–°éƒ¨ç½²äº‘å‡½æ•°

### æ–¹æ³•ä¸‰ï¼šä¿®æ”¹å®šæ—¶è§¦å‘å™¨æ—¶é—´ï¼ˆä¸´æ—¶æµ‹è¯•ï¼‰

1. **ä¿®æ”¹ `cloudfunctions/sendReminder/config.json`**
   
   ```json
   {
     "triggers": [
       {
         "name": "dailyReminder",
         "type": "timer",
         "config": "0 * * * * * *"  // æ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡ï¼ˆä»…æµ‹è¯•ç”¨ï¼‰
       }
     ]
   }
   ```

2. **é‡æ–°éƒ¨ç½²äº‘å‡½æ•°**
3. **ç­‰å¾…1åˆ†é’ŸåæŸ¥çœ‹ç»“æœ**
4. **æµ‹è¯•å®Œæˆåæ¢å¤åŸé…ç½®**

## ğŸ” å¸¸è§é—®é¢˜æ’æŸ¥

### é—®é¢˜1ï¼šè®¢é˜…åæ²¡æœ‰æ”¶åˆ°æ¶ˆæ¯

**å¯èƒ½åŸå› ï¼š**
1. âŒ æœªåœ¨çœŸæœºä¸Šæµ‹è¯•ï¼ˆå¼€å‘è€…å·¥å…·ä¸æ”¯æŒï¼‰
2. âŒ ç”¨æˆ·æœªæˆæƒè®¢é˜…æ¶ˆæ¯
3. âŒ å®šæ—¶è§¦å‘å™¨æœªåˆ°æ‰§è¡Œæ—¶é—´
4. âŒ äº‘å‡½æ•°æœªæ­£ç¡®éƒ¨ç½²
5. âŒ æ¨¡æ¿IDä¸æ­£ç¡®
6. âŒ æ•°æ®åº“ä¸­æ²¡æœ‰è®¢é˜…è®°å½•

**æ’æŸ¥æ­¥éª¤ï¼š**
1. ç¡®è®¤åœ¨çœŸæœºä¸Šæµ‹è¯•
2. æ£€æŸ¥äº‘å¼€å‘æ§åˆ¶å° â†’ æ•°æ®åº“ â†’ `subscribe_settings`ï¼ŒæŸ¥çœ‹æ˜¯å¦æœ‰ä½ çš„è®°å½•
3. æ£€æŸ¥ `subscribeResult` å­—æ®µï¼Œç¡®è®¤æˆæƒçŠ¶æ€
4. æŸ¥çœ‹äº‘å‡½æ•°æ—¥å¿—ï¼Œç¡®è®¤æ˜¯å¦æ‰§è¡Œ
5. æ£€æŸ¥æ¨¡æ¿IDæ˜¯å¦æ­£ç¡®

### é—®é¢˜2ï¼šæˆæƒå¼¹çª—æ²¡æœ‰å‡ºç°

**å¯èƒ½åŸå› ï¼š**
1. âŒ ç”¨æˆ·ä¹‹å‰å·²ç»æˆæƒè¿‡ï¼ˆæ¯ä¸ªæ¨¡æ¿åªèƒ½æˆæƒä¸€æ¬¡ï¼‰
2. âŒ ä»£ç ä¸­ `wx.requestSubscribeMessage` è°ƒç”¨å¤±è´¥
3. âŒ æ¨¡æ¿IDä¸æ­£ç¡®

**æ’æŸ¥æ­¥éª¤ï¼š**
1. æ£€æŸ¥æ§åˆ¶å°æ˜¯å¦æœ‰é”™è¯¯ä¿¡æ¯
2. ç¡®è®¤æ¨¡æ¿IDæ˜¯å¦æ­£ç¡®
3. å°è¯•æ¸…é™¤å°ç¨‹åºç¼“å­˜åé‡æ–°æµ‹è¯•

### é—®é¢˜3ï¼šäº‘å‡½æ•°æ‰§è¡Œå¤±è´¥

**æŸ¥çœ‹æ—¥å¿—ï¼š**
1. äº‘å¼€å‘æ§åˆ¶å° â†’ äº‘å‡½æ•° â†’ `sendReminder` â†’ æ—¥å¿—
2. æŸ¥çœ‹é”™è¯¯ä¿¡æ¯

**å¸¸è§é”™è¯¯ï¼š**
- `access_token missing`ï¼šäº‘å¼€å‘ç¯å¢ƒæœªæ­£ç¡®åˆå§‹åŒ–
- `template_id invalid`ï¼šæ¨¡æ¿IDä¸æ­£ç¡®
- `user refuse`ï¼šç”¨æˆ·æœªæˆæƒ

### é—®é¢˜4ï¼šå®šæ—¶è§¦å‘å™¨ä¸æ‰§è¡Œ

**å¯èƒ½åŸå› ï¼š**
1. âŒ å®šæ—¶è§¦å‘å™¨é…ç½®é”™è¯¯
2. âŒ äº‘å‡½æ•°æœªéƒ¨ç½²
3. âŒ éœ€è¦ç­‰å¾…å‡ åˆ†é’Ÿæ‰èƒ½ç”Ÿæ•ˆ

**æ’æŸ¥æ­¥éª¤ï¼š**
1. æ£€æŸ¥ `config.json` ä¸­çš„ cron è¡¨è¾¾å¼
2. ç¡®è®¤äº‘å‡½æ•°å·²éƒ¨ç½²
3. ç­‰å¾…5-10åˆ†é’Ÿåé‡è¯•

## ğŸ“± çœŸæœºæµ‹è¯•æ­¥éª¤ï¼ˆè¯¦ç»†ï¼‰

1. **å‡†å¤‡**
   - ç¡®ä¿å°ç¨‹åºå·²å‘å¸ƒæˆ–ä½¿ç”¨ä½“éªŒç‰ˆ
   - åœ¨å¾®ä¿¡å¼€å‘è€…å·¥å…·ä¸­ï¼Œç‚¹å‡»"é¢„è§ˆ"æˆ–"ä¸Šä¼ "
   - ç”¨å¾®ä¿¡æ‰«ç åœ¨æ‰‹æœºä¸Šæ‰“å¼€

2. **è®¢é˜…**
   - åœ¨æ‰‹æœºä¸Šæ‰“å¼€å°ç¨‹åº
   - ç‚¹å‡»é¦–é¡µé“ƒé“›å›¾æ ‡
   - é€‰æ‹©è®¡åˆ’å¹¶å¼€å¯æé†’
   - ç‚¹å‡»"å¼€å¯æé†’è®¡åˆ’"
   - **é‡è¦**ï¼šä¼šå¼¹å‡ºæˆæƒå¼¹çª—ï¼Œå¿…é¡»ç‚¹å‡»"å…è®¸"

3. **éªŒè¯è®¢é˜…**
   - åœ¨äº‘å¼€å‘æ§åˆ¶å°æŸ¥çœ‹æ•°æ®åº“è®°å½•
   - ç¡®è®¤ `subscribeResult` ä¸­æœ‰æˆæƒä¿¡æ¯

4. **ç­‰å¾…æˆ–æ‰‹åŠ¨è§¦å‘**
   - ç­‰å¾…å®šæ—¶è§¦å‘ï¼ˆ10:00ã€14:00ã€20:00ï¼‰
   - æˆ–ä½¿ç”¨æ‰‹åŠ¨è§¦å‘æ–¹æ³•æµ‹è¯•

## ğŸ’¡ æµ‹è¯•æŠ€å·§

1. **ä½¿ç”¨æµ‹è¯•æ¨¡æ¿ID**
   - åœ¨å¼€å‘é˜¶æ®µï¼Œå¯ä»¥ç”³è¯·æµ‹è¯•æ¨¡æ¿ID
   - æµ‹è¯•æ¨¡æ¿IDå¯ä»¥æ— é™æ¬¡å‘é€ï¼Œæ–¹ä¾¿æµ‹è¯•

2. **æŸ¥çœ‹äº‘å‡½æ•°æ—¥å¿—**
   - äº‘å¼€å‘æ§åˆ¶å° â†’ äº‘å‡½æ•° â†’ æ—¥å¿—
   - å¯ä»¥çœ‹åˆ°è¯¦ç»†çš„æ‰§è¡Œæ—¥å¿—å’Œé”™è¯¯ä¿¡æ¯

3. **æ£€æŸ¥æ•°æ®åº“è®°å½•**
   - ç¡®è®¤è®¢é˜…è®¾ç½®å·²ä¿å­˜
   - ç¡®è®¤ `openid` æ­£ç¡®
   - ç¡®è®¤ `subscribeResult` æœ‰æˆæƒä¿¡æ¯

4. **ä½¿ç”¨ä½“éªŒç‰ˆæµ‹è¯•**
   - å‘å¸ƒä½“éªŒç‰ˆï¼Œé‚€è¯·æµ‹è¯•ç”¨æˆ·
   - ä½“éªŒç‰ˆå¯ä»¥æ­£å¸¸æ¥æ”¶è®¢é˜…æ¶ˆæ¯

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **è®¢é˜…æ¶ˆæ¯é™åˆ¶**
   - æ¯ä¸ªç”¨æˆ·æ¯ä¸ªæ¨¡æ¿åªèƒ½æˆæƒä¸€æ¬¡
   - æˆæƒå7å¤©å†…æœ‰æ•ˆ
   - éœ€è¦ç”¨æˆ·ä¸»åŠ¨è§¦å‘æ‰èƒ½æˆæƒ

2. **å®šæ—¶è§¦å‘å™¨é™åˆ¶**
   - éƒ¨ç½²åéœ€è¦ç­‰å¾…å‡ åˆ†é’Ÿæ‰èƒ½ç”Ÿæ•ˆ
   - Cronè¡¨è¾¾å¼æ ¼å¼ï¼š`ç§’ åˆ† æ—¶ æ—¥ æœˆ æ˜ŸæœŸ å¹´`

3. **çœŸæœºæµ‹è¯•å¿…é¡»**
   - è®¢é˜…æ¶ˆæ¯åŠŸèƒ½åªèƒ½åœ¨çœŸæœºä¸Šæµ‹è¯•
   - å¼€å‘è€…å·¥å…·æ— æ³•æ¨¡æ‹Ÿè®¢é˜…æ¶ˆæ¯

4. **æ¨¡æ¿å­—æ®µé™åˆ¶**
   - å­—æ®µå€¼é•¿åº¦æœ‰é™åˆ¶
   - éœ€è¦ä¸¥æ ¼æŒ‰ç…§æ¨¡æ¿å­—æ®µè¦æ±‚å¡«å†™

## ğŸ“ å¦‚æœè¿˜æ˜¯æ”¶ä¸åˆ°æ¶ˆæ¯

1. æ£€æŸ¥äº‘å‡½æ•°æ—¥å¿—ï¼ŒæŸ¥çœ‹å…·ä½“é”™è¯¯
2. ç¡®è®¤æ¨¡æ¿IDå’Œå­—æ®µåæ˜¯å¦æ­£ç¡®
3. ç¡®è®¤ç”¨æˆ·å·²æˆæƒè®¢é˜…æ¶ˆæ¯
4. ç¡®è®¤å®šæ—¶è§¦å‘å™¨å·²æ­£ç¡®é…ç½®
5. å°è¯•æ‰‹åŠ¨è§¦å‘äº‘å‡½æ•°æµ‹è¯•
